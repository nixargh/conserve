#!/usr/bin/ruby
#### INFO ######################################################################
# Conserve - linux backup tool.
# (*w) author: nixargh <nixargh@gmail.com>
$version = '0.2.0.4'
#### SETTINGS ##################################################################
#### REQUIRE ###################################################################
require 'fileutils'
#### CLASES ####################################################################
class Conserve
	def initialize
		@debug = false
		@lib_dir = '/usr/lib/conserve'
		ENV['PATH'] = "#{ENV['PATH']}:/sbin:/usr/sbin:/usr/local/sbin:/usr/local/bin:/usr/bin:/bin"
		@params = nil
		@log = nil
	end

	def run
		load_libraries!
		parse_arguments!
		start_logging!
	end

	private

	def load_libraries! # loads additional Classses
		$LOAD_PATH.unshift("./lib")
		$LOAD_PATH.unshift(@lib_dir)
		require 'lvm_operate'
		require 'backup'
		require 'operate'
		require 'inform'
		require 'ruby_gems'
		require 'log'
		require 'collector'
	end

	def parse_arguments! # parse command line arguments
		operate = Operate.new
		@params = operate.read_arguments
	end

	def start_logging!
		@log = Log.new
	end

	def collect_info # collect system information about disk, raids, partitions, lvm and mounts
		collector = Collector.new
		collector.collect
	end
end
#### FUNCTIONS #################################################################
#### PROGRAM ###################################################################
begin
	conserve = Conserve.new
	conserve.run
rescue
	puts "\t#{$!}"
	exit 1
end
